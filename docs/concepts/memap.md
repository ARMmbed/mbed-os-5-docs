# memap - Static Memory Map Analysis

## Introduction

*memap* is a simple utility that displays static memory information required by [mbed](https://github.com/mbedmicro/mbed) applications. This information is produced by analyzing the memory map file previously generated by your toolchain.

**Note**: This tool shows static RAM usage and the total size of allocated heap and stack space defined at compile time, not the actual heap and stack usage (which may be different depending on your application).

## Using memap

*memap* is automatically invoked after an mbed build finishes successfully. It's also possible to manually run the program with different command-line options, for example:

```
$ python memap.py
usage: memap.py [-h] -t TOOLCHAIN [-d DEPTH] [-o OUTPUT] [-e EXPORT] [-v] file

Memory Map File Analyser for ARM mbed version 0.4.0

positional arguments:
  file                  memory map file

optional arguments:
  -h, --help            show this help message and exit
  -t TOOLCHAIN, --toolchain TOOLCHAIN
                        select a toolchain used to build the memory map file
                        (ARM, ARM_STD, ARM_MICRO, GCC_ARM, GCC_CR, IAR)
  -d DEPTH, --depth DEPTH
                        specify directory depth level to display report
  -o OUTPUT, --output OUTPUT
                        output file name
  -e EXPORT, --export EXPORT
                        export format (examples: json, csv-ci, table: default)
  -v, --version         show program's version number and exit

```

Result example:

```
$ python mbed-os/tools/memap.py BUILD/K64F/GCC_ARM/example.map -t GCC_ARM
+------------------+-------+-------+-------+
| Module           | .text | .data |  .bss |
+------------------+-------+-------+-------+
| [fill]           |    62 |     4 |  2513 |
| [lib]/libc.a     | 22434 |  2204 |    56 |
| [lib]/libgcc.a   |  3728 |     0 |     0 |
| [lib]/libm.a     |    88 |     0 |     0 |
| [lib]/libnosys.a |    32 |     0 |     0 |
| [lib]/misc       |   232 |     8 |    28 |
| main.o           |    56 |     0 |     4 |
| mbed-os/features |    42 |     0 |   184 |
| mbed-os/hal      |   450 |     0 |     8 |
| mbed-os/platform |  1252 |     4 |   269 |
| mbed-os/rtos     |  5955 |    24 |  6874 |
| mbed-os/targets  |  9788 |    12 |   384 |
| Subtotals        | 44119 |  2256 | 10320 |
+------------------+-------+-------+-------+
Total Static RAM memory (data + bss): 12576 bytes
Total Flash memory (text + data): 46375 bytes
```

## Information on memory sections

The table above showed multiple memory sections.

- ``.text``: is where the code application and constants are located in Flash.
- ``.data``: nonzero initialized variables; allocated in both RAM and Flash memory (variables are copied from Flash to RAM at runtime).
- ``.bss``: uninitialized data allocated in RAM, or variables initialized to zero.

**Note**: This tool displays static RAM and Flash usage. The heap and stack space are not included in the report as are usually configured at run time, and it's likely to change from one application to another.

There are other entries that require a bit of clarification:

- Fill: represents the bytes in multiple sections (RAM and Flash) that the toolchain has filled with zeros because it requires subsequent data or code to be aligned appropriately in memory.
- Misc: usually represents helper libraries introduced by the toolchain but can also represent modules that are not part of mbed.

## Other useful information

It's possible to specify the depth value of the directory level when generating a report. By default *memap* is configured as `--depth=2`, but note that specifying `--depth=0` will display a full report. For example:

```
$ python mbed-os/tools/memap.py BUILD/K64F/GCC_ARM/example.map -t GCC_ARM --depth 0
```

As *memap* is automatically invoked when compiling an application with mbed CLI, it's also possible to specify the depth level with `--stats-depth`. For example:

```
mbed compile -t GCC_ARM -m K64F --stats-depth 3
```

## Current support

We have tested *memap* on Windows 7, Windows 10, Linux and Mac OS X. The GCC_ARM (GNU ARM Embedded Toolchain), ARM (ARM Compiler 5) and IAR toolchains generate memory map files.

## Known issues and new features

The information generated by this utility may not be fully accurate and may vary from one toolchain to another. This might be caused by custom definitions of the linker scripts files or by the usage of non standard memory sections.

If you are experiencing problems, or would like additional features, please raise a ticket on [GitHub](https://github.com/mbedmicro/mbed/issues) and use ```[memap] ``` in the title.
